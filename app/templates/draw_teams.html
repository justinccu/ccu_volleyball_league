<!DOCTYPE html>
<html lang="zh-Hant" class="h-full w-full">

<head>
    <meta charset="utf-8" />
    <title>Volleyball League Admin — 分組抽籤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&family=Lexend:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>

<body class="relative flex size-full min-h-screen flex-col bg-gray-50 overflow-x-hidden"
    style='font-family: Lexend, "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">
        <!-- Header -->
        <header
            class="flex items-center justify-between border-b border-[#eaeef1] px-10 py-3 bg-white fixed top-0 left-0 right-0 z-10">
            <div class="flex items-center gap-4">
                <div class="size-4">
                    <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
                    </svg>
                </div>
                <h2 class="text-lg font-bold text-[#101518] tracking-[-0.015em]">中正排球聯盟</h2>
            </div>
            <div class="flex flex-1 justify-end gap-8">
                <nav class="flex items-center gap-9">
                    <a class="text-[#101518] text-sm font-medium" href="{{ url_for('main.dashboard') }}">Dashboard</a>
                    <a class="text-[#101518] text-sm font-medium" href="{{ url_for('main.edit_profile') }}">Profile</a>
                </nav>
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                    style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDt2IBTIdCHam2F8XQEDrt_7eYY2hPMdKkYDilkB7cOMMGaoVDUtqfkgNImtBkTfueXva8doqU8PZT0puBWecaKF0jjDJfIj4MoLjDcgeCN1JjowkQoLT2DgEGahMD-C5OCVo8In0Iauj4aXK-qd2nYxqBaUTOW1h-aDYS6Y5Wo-3yV2Uw23pzgvK4IwYbWqYojbg77RYVqG3TW4uOKXfzdULQgar8h5KQY9Td_ntOiPe6gxvXpea3D4uOTTgsOnI0LlLuuLAv8rTLM");'>
                </div>
            </div>
        </header>

        <div class="px-40 flex flex-1 justify-center py-5 mt-16" style="padding-top: 64px;">
            <div class="layout-content-container flex flex-col max-w-[960px] flex-1 space-y-6">
                <!-- PAGE TITLE -->
                <p class="text-[32px] font-bold text-[#101418]">分組抽籤</p>

                <!-- 1) 選擇隊伍類型和開始日期 -->
                <section class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">1. 選擇隊伍類型與開始日期</h2>
                    <form method="POST" action="{{ url_for('main.draw_teams') }}"
                        class="flex flex-col lg:flex-row lg:items-end lg:space-x-6 space-y-4 lg:space-y-0">
                        <!-- 隊伍類型 -->
                        <div class="flex-1">
                            <label class="block text-sm font-medium mb-2">隊伍類型</label>
                            <div class="flex gap-4">
                                <label class="inline-flex items-center space-x-2">
                                    <input type="radio" name="team_type" value="男排"
                                        class="form-radio h-5 w-5 text-blue-600" required {% if
                                        request.form.team_type=='男排' %}checked{% endif %} />
                                    <span>男排</span>
                                </label>
                                <label class="inline-flex items-center space-x-2">
                                    <input type="radio" name="team_type" value="女排"
                                        class="form-radio h-5 w-5 text-blue-600" required {% if
                                        request.form.team_type=='女排' %}checked{% endif %} />
                                    <span>女排</span>
                                </label>
                            </div>
                        </div>
                        <!-- 開始日期 -->
                        <div class="flex-1">
                            <label for="start_date" class="block text-sm font-medium mb-2">開始日期</label>
                            <input type="date" name="start_date" id="start_date" required
                                value="{{ request.form.start_date or '' }}"
                                class="w-full px-4 py-2 border rounded-lg bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-300" />
                        </div>
                        <!-- 提交按鈕 -->
                        <button type="submit"
                            class="px-6 py-2 bg-blue-600 text-white font-medium rounded-full hover:bg-blue-700 transition">
                            執行抽籤
                        </button>
                    </form>
                </section>

                {% if team_type %}
                <!-- 2) 分組結果 -->
                <section class="bg-white p-6 rounded-lg shadow space-y-4">
                    <h2 class="text-xl font-semibold">2. {{ team_type }} 抽籤結果</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <h3 class="text-lg font-medium text-blue-600">A 組</h3>
                            <ul class="list-disc list-inside space-y-1">
                                {% for team in group_a %}
                                <li>{{ team.name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="space-y-2">
                            <h3 class="text-lg font-medium text-blue-600">B 組</h3>
                            <ul class="list-disc list-inside space-y-1">
                                {% for team in group_b %}
                                <li>{{ team.name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- 3) 生成賽程 -->
                <section class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">3. 生成賽程</h2>
                    <form method="POST" action="{{ url_for('main.generate_schedule') }}"
                        class="flex flex-col sm:flex-row sm:items-center sm:space-x-6 space-y-4 sm:space-y-0">
                        <input type="hidden" name="team_type" value="{{ team_type }}">
                        <input type="hidden" name="start_date" value="{{ request.form.start_date or '' }}">
                        {% for team in group_a %}
                        <input type="hidden" name="group_a" value="{{ team.name }}">
                        {% endfor %}
                        {% for team in group_b %}
                        <input type="hidden" name="group_b" value="{{ team.name }}">
                        {% endfor %}

                        <button type="submit"
                            class="px-6 py-2 bg-green-600 text-white font-medium rounded-full hover:bg-green-700 transition">
                            生成賽程
                        </button>
                    </form>
                </section>

                <!-- Flash messages -->
                {% with messages = get_flashed_messages() %}
                {% if messages %}
                <section class="space-y-2">
                    {% for msg in messages %}
                    <div
                        class="p-3 rounded-md {{ 'bg-green-100 text-green-800' if '❌' not in msg else 'bg-red-100 text-red-800' }}">
                        {{ msg }}
                    </div>
                    {% endfor %}
                </section>
                {% endif %}
                {% endwith %}

                <!-- 4) 已生成賽程顯示 -->
                {% if matches %}
                <section class="space-y-4">
                    <h2 class="text-xl font-semibold">4. 已生成賽程</h2>
                    <div class="grid grid-cols-1 gap-8">
                        {% for cycle in ['A','B'] %}
                        <div>
                            <h3 class="text-lg font-medium text-blue-600 mb-2">{{ cycle }} 組賽程</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                {% for match in matches if match.team1.team_cycle == cycle %}
                                <div class="p-4 bg-gray-100 rounded-lg shadow">
                                    <p class="text-sm"><strong>時間：</strong>{{ match.match_time.strftime('%m/%d %H:00')
                                        }}</p>
                                    <p class="text-sm"><strong>隊伍：</strong>{{ match.team1.name }} vs {{ match.team2.name
                                        }}</p>
                                    <p class="text-sm"><strong>裁判：</strong>{{ match.referee.name }}</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
</body>

</html>