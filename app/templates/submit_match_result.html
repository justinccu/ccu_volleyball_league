<!DOCTYPE html>
<html>
<head>
    <title>ç™»éŒ„æ¯”è³½çµæœ</title>
    <style>
        .flash-message {
            margin-top: 20px;
        }
        .text-red {
            color: red;
            font-weight: bold;
        }
        .text-green {
            color: green;
            font-weight: bold;
        }
    </style>
    <script>
        function updateWinner() {
            const t1s1 = parseInt(document.querySelector('input[name="team1_set1"]').value || 0);
            const t2s1 = parseInt(document.querySelector('input[name="team2_set1"]').value || 0);
            const t1s2 = parseInt(document.querySelector('input[name="team1_set2"]').value || 0);
            const t2s2 = parseInt(document.querySelector('input[name="team2_set2"]').value || 0);
            const t1s3 = parseInt(document.querySelector('input[name="team1_set3"]').value || 0);
            const t2s3 = parseInt(document.querySelector('input[name="team2_set3"]').value || 0);

            let team1_win = 0;
            let team2_win = 0;

            if (t1s1 || t2s1) team1_win += t1s1 > t2s1 ? 1 : (t1s1 < t2s1 ? 0 : 0);
            if (t1s2 || t2s2) team1_win += t1s2 > t2s2 ? 1 : (t1s2 < t2s2 ? 0 : 0);
            if (t1s3 || t2s3) team1_win += t1s3 > t2s3 ? 1 : (t1s3 < t2s3 ? 0 : 0);

            team2_win = (t1s1 || t2s1 ? 1 : 0) + (t1s2 || t2s2 ? 1 : 0) + (t1s3 || t2s3 ? 1 : 0) - team1_win;

            const team1_name = document.getElementById("team1_name").textContent;
            const team2_name = document.getElementById("team2_name").textContent;
            const resultText = document.getElementById("winner_result");

            if (team1_win + team2_win >= 2) {
                if (team1_win > team2_win) {
                    resultText.textContent = `ğŸ† æœ€çµ‚å‹æ–¹ï¼š${team1_name}ã€€ï½œ æ•—æ–¹ï¼š${team2_name}`;
                } else if (team2_win > team1_win) {
                    resultText.textContent = `ğŸ† æœ€çµ‚å‹æ–¹ï¼š${team2_name}ã€€ï½œ æ•—æ–¹ï¼š${team1_name}`;
                } else {
                    resultText.textContent = '';
                }
            } else {
                resultText.textContent = '';
            }
        }

        function validateForm() {
            const set1_team1 = parseInt(document.querySelector('input[name="team1_set1"]').value || 0);
            const set1_team2 = parseInt(document.querySelector('input[name="team2_set1"]').value || 0);
            const set2_team1 = parseInt(document.querySelector('input[name="team1_set2"]').value || 0);
            const set2_team2 = parseInt(document.querySelector('input[name="team2_set2"]').value || 0);
            const set3_team1 = parseInt(document.querySelector('input[name="team1_set3"]').value || 0);
            const set3_team2 = parseInt(document.querySelector('input[name="team2_set3"]').value || 0);

            const lamp1 = parseInt(document.querySelector('input[name="team1_lamp_fee"]').value || 0);
            const lamp2 = parseInt(document.querySelector('input[name="team2_lamp_fee"]').value || 0);

            if ((lamp1 + lamp2) > 80) {
                alert("å…©éšŠç¸½ç‡ˆéŒ¢ä¸å¾—è¶…é 80 å…ƒ");
                return false;
            }

            let team1_win = 0;
            let team2_win = 0;
            if (set1_team1 > set1_team2) team1_win++; else team2_win++;
            if (set2_team1 > set2_team2) team1_win++; else team2_win++;
            if (team1_win === 1 && team2_win === 1) {
                if (!set3_team1 || !set3_team2) {
                    alert("å‰å…©å±€é›™æ–¹å„è´ä¸€å±€ï¼Œè«‹å¡«å¯«ç¬¬ä¸‰å±€æ¯”åˆ†");
                    return false;
                }
                if (set3_team1 > set3_team2) team1_win++; else team2_win++;
            }

            return true;
        }
    </script>
</head>
<body>
    <h2>ğŸ“‹ ç™»éŒ„æ¯”è³½çµæœ</h2>

    <p id="winner_result" style="font-weight:bold; color:green;"></p>

    <p><strong>æ¯”è³½éšŠä¼:</strong> <span id="team1_name">{{ match.team1.name }}</span> vs <span id="team2_name">{{ match.team2.name }}</span></p>
    <p><strong>è£åˆ¤éšŠä¼:</strong> {{ match.referee.name }}</p>
    <p><strong>æ¯”è³½æ™‚é–“:</strong> {{ match.match_time or 'å°šæœªè¨­å®š' }}</p>

    <form method="POST" onsubmit="return validateForm()">
        <h4>æ¯”åˆ†ç´€éŒ„(æœ€å¤šä¸‰å±€)</h4>
        <label>ç¬¬1å±€:</label>
        <input type="number" name="team1_set1" required oninput="updateWinner()"> : 
        <input type="number" name="team2_set1" required oninput="updateWinner()"><br>

        <label>ç¬¬2å±€:</label>
        <input type="number" name="team1_set2" required oninput="updateWinner()"> : 
        <input type="number" name="team2_set2" required oninput="updateWinner()"><br>

        <label>ç¬¬3å±€:</label>
        <input type="number" name="team1_set3" oninput="updateWinner()"> : 
        <input type="number" name="team2_set3" oninput="updateWinner()"><br>

        <br>
        <label>ç‡ˆéŒ¢({{ match.team1.name }}):</label>
        <input type="number" name="team1_lamp_fee" required><br>

        <label>ç‡ˆéŒ¢({{ match.team2.name }}):</label>
        <input type="number" name="team2_lamp_fee" required><br>

        <br>
        <button type="submit">ç™»éŒ„æ¯”è³½çµæœ</button>
    </form>

    <br>
    <a href="/dashboard">å›ä¸»é </a>
</body>
</html>